#!/usr/bin/env sh
# Pre-push hook - Created by Balaji Koneti
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run tests for all services
echo "ğŸ§ª Running tests..."

# Backend tests
if [ -d "backend" ]; then
  echo "ğŸ“¦ Testing backend..."
  cd backend
  npm run test:ci
  if [ $? -ne 0 ]; then
    echo "âŒ Backend tests failed!"
    exit 1
  fi
  cd ..
fi

# Frontend tests
if [ -d "frontend" ]; then
  echo "ğŸ“¦ Testing frontend..."
  cd frontend
  npm run test:run
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend tests failed!"
    exit 1
  fi
  cd ..
fi

# ML tests
if [ -d "ml" ]; then
  echo "ğŸ“¦ Testing ML service..."
  cd ml
  python -m pytest tests/ -v --cov=src --cov-report=term-missing
  if [ $? -ne 0 ]; then
    echo "âŒ ML tests failed!"
    exit 1
  fi
  cd ..
fi

echo "âœ… All tests passed! Ready to push."
