#!/usr/bin/env sh
# Pre-commit hook - Created by Balaji Koneti
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Backend checks
if [ -d "backend" ]; then
  echo "ğŸ“¦ Checking backend..."
  cd backend
  
  # Type checking
  echo "ğŸ”§ Running TypeScript type check..."
  npm run type-check
  
  # Linting
  echo "ğŸ§¹ Running ESLint..."
  npm run lint
  
  # Formatting check
  echo "ğŸ’… Checking Prettier formatting..."
  npm run format:check
  
  cd ..
fi

# Frontend checks
if [ -d "frontend" ]; then
  echo "ğŸ“¦ Checking frontend..."
  cd frontend
  
  # Type checking
  echo "ğŸ”§ Running TypeScript type check..."
  npm run type-check
  
  # Linting
  echo "ğŸ§¹ Running ESLint..."
  npm run lint
  
  # Formatting check
  echo "ğŸ’… Checking Prettier formatting..."
  npm run format:check
  
  cd ..
fi

# ML checks
if [ -d "ml" ]; then
  echo "ğŸ“¦ Checking ML service..."
  cd ml
  
  # Python linting
  echo "ğŸ§¹ Running flake8..."
  flake8 src/ tests/
  
  # Black formatting check
  echo "ğŸ’… Checking Black formatting..."
  black --check src/ tests/
  
  # Import sorting check
  echo "ğŸ“‹ Checking import sorting..."
  isort --check-only src/ tests/
  
  # Type checking
  echo "ğŸ”§ Running mypy type check..."
  mypy src/
  
  cd ..
fi

echo "âœ… All pre-commit checks passed!"
